<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Baseline Dash JavaScript Player</title>
    <meta name="description" content="" />
    <link rel="icon" type="image/png" href="http://dashpg.com/w/2012/09/dashif.ico" />

    <!-- http://jquery.com/ -->
    <script src="app/lib/jquery/jquery-1.10.2.min.js"></script>

    <!-- https://github.com/kriskowal/q -->
    <script src="app/lib/q.js"></script>

    <!-- https://github.com/creynders/dijon-framework -->
    <script src="app/lib/dijon.js"></script>

    <!-- http://bannister.us/weblog/2007/06/09/simple-base64-encodedecode-javascript/ -->
    <script src="app/lib/base64.js"></script>

    <!-- Misc Libs -->
    <script src="app/lib/xml2json.js"></script>
    <script src="app/lib/objectiron.js"></script>
    <script src="app/lib/long.js"></script>
    <script src="app/lib/Math.js"></script>

    <!-- Player -->
    <script src="app/js/streaming/MediaPlayer.js"></script>
    <script src="app/js/streaming/Context.js"></script>
    <script src="app/js/streaming/ErrorHandler.js"></script>
    <script src="app/js/streaming/Capabilities.js"></script>
    <script src="app/js/streaming/EventBus.js"></script>
    <script src="app/js/streaming/Debug.js"></script>
    <script src="app/js/streaming/VideoModel.js"></script>
    <script src="app/js/streaming/vo/SegmentRequest.js"></script>
    <script src="app/js/streaming/ManifestLoader.js"></script>
    <script src="app/js/streaming/ManifestUpdater.js"></script>
    <script src="app/js/streaming/ManifestModel.js"></script>
    <script src="app/js/streaming/MediaSourceExtensions.js"></script>
    <script src="app/js/streaming/SourceBufferExtensions.js"></script>
    <script src="app/js/streaming/VideoModelExtensions.js"></script>
    <script src="app/js/streaming/BufferExtensions.js"></script>
    <script src="app/js/streaming/FragmentController.js"></script>
    <script src="app/js/streaming/AbrController.js"></script>
    <script src="app/js/streaming/FragmentLoader.js"></script>
    <script src="app/js/streaming/StreamController.js"></script>
    <script src="app/js/streaming/Stream.js"></script>
    <script src="app/js/streaming/BufferController.js"></script>
    <script src="app/js/streaming/ProtectionModel.js"></script>
    <script src="app/js/streaming/ProtectionController.js"></script>
    <script src="app/js/streaming/ProtectionExtensions.js"></script>
    <script src="app/js/streaming/rules/SwitchRequest.js"></script>
    <script src="app/js/streaming/rules/DownloadRatioRule.js"></script>
    <script src="app/js/streaming/rules/InsufficientBufferRule.js"></script>
    <script src="app/js/streaming/rules/LimitSwitchesRule.js"></script>
    <script src="app/js/streaming/rules/BaseRulesCollection.js"></script>

    <!--Captioning-->
    <script src="app/js/streaming/captioning/VTTParser.js"></script>
    <script src="app/js/streaming/captioning/TextTrackExtensions.js"></script>
    <script src="app/js/streaming/captioning/TextVTTSourceBuffer.js"></script>
    <script src="app/js/streaming/captioning/TextController.js"></script>

    <!-- Metrics -->
    <script src="app/js/streaming/vo/MetricsList.js"></script>
    <script src="app/js/streaming/MetricsModel.js"></script>
    <script src="app/js/streaming/vo/metrics/BufferLevel.js"></script>
    <script src="app/js/streaming/vo/metrics/HTTPRequest.js"></script>
    <script src="app/js/streaming/vo/metrics/PlayList.js"></script>
    <script src="app/js/streaming/vo/metrics/RepresentationSwitch.js"></script>
    <script src="app/js/streaming/vo/metrics/TCPConnection.js"></script>
    <script src="app/js/streaming/vo/metrics/DroppedFrames.js"></script>

    <!-- Dash -->
    <script src="app/js/dash/Dash.js"></script>
    <script src="app/js/dash/DashContext.js"></script>
    <script src="app/js/dash/vo/Segment.js"></script>
    <script src="app/js/dash/DashParser.js"></script>
    <script src="app/js/dash/DashHandler.js"></script>
    <script src="app/js/dash/BaseURLExtensions.js"></script>
    <script src="app/js/dash/FragmentExtensions.js"></script>
    <script src="app/js/dash/DashManifestExtensions.js"></script>
    <script src="app/js/dash/DashMetricsExtensions.js"></script>

    <!-- Sinclair -->
    <script src="app/js/sinclair/SinclairManifestExtensions.js"></script>
    <script src="app/js/sinclair/SinclairContext.js"></script>

    <script>
        var SINCLAIR = "http://63.88.63.42/mpegdash-stream/sbgbase3mb30fps/male/male_manifest.mpd",
            MANIFEST_1 = "http://63.88.63.42/mpegdash-stream/stream1/manifest.mpd",
            MANIFEST_2 = "http://63.88.63.42/mpegdash-stream/stream3/droid_livemanifest.mpd",
            SERVER = "http://63.88.63.42/mpegdash-stream/api/";
        
        function playTest () {
            startVideo(SINCLAIR);
        }

        function toggle () {
            var ENDPOINT = SERVER + "?drop";
                req = new XMLHttpRequest();
            req.open("GET", ENDPOINT, true);
            req.send();
        }

        function reset () {
            var ENDPOINT = SERVER + "?reset";
                req = new XMLHttpRequest();
            req.open("GET", ENDPOINT, true);
            req.send();
        }

        function startVideo (url) {
            var video,
                context,
                player;

            video = document.querySelector(".dash-video-player video");
            context = new MediaPlayer.sinclair.SinclairContext();
            player = new MediaPlayer(context);

            player.startup();

            player.attachView(video);
            player.setAutoPlay(true);

            player.attachSource(url);

            // DEBUG - REMOVE ME!
            setInterval(function () {
                $("#debug").text("Current time: " + player.getVideoModel().getCurrentTime());
            }, 800);
            // ------------------
        }
    </script>

    <style>
        .nav button {
            display: inline-block;
        }

        video {
            width: 640px;
            height: 480px;
        }
    </style>

    <body>
        <div class="nav">
            <button onclick="playTest()">Play Stream</button>
            <button onclick="toggle()">Toggle Server</button>
            <button onclick="reset()">Reset Server</button>
        </div>

        <!-- DEBUG - REMOVE ME! -->
        <div id="debug"></div>
        <!-- ------------------ -->

        <div class="dash-video-player">
            <video controls="true"></video>
        </div>
    </body>
</html>
